const mavMobileMenuIcon = document.querySelector('.mav-mobile-menu-icon');

const mavHeaderMenu = document.querySelector('#mavid-header-menu');

const mavSubMenuParentItems = mavHeaderMenu.querySelectorAll('.menu-item-has-children');

let mavSubMenuNumber = 1;

for (const mavSubMenuParentItem of mavSubMenuParentItems) {
    // Create submenu icon element
    const mavSubMenuIcon = document.createElement('div');
    mavSubMenuIcon.classList.add('mav-submenu-icon');
    mavSubMenuIcon.dataset.number = mavSubMenuNumber;
    mavSubMenuIcon.dataset.current = 0;
    mavSubMenuIcon.dataset.state = 'close';

    mavSubMenuIcon.addEventListener('click',mavf_toggle_submenu);

    mavSubMenuParentItem.prepend(mavSubMenuIcon);

    const mavSubMenuItem = mavSubMenuParentItem.querySelector('.sub-menu');

    mavSubMenuItem.dataset.number  = mavSubMenuNumber;
    mavSubMenuItem.dataset.current  = 0;
    mavSubMenuItem.dataset.state  = 'close';

    mavSubMenuNumber++;
}

const mavSubMenuIcons = document.querySelectorAll('.mav-submenu-icon');

function mavf_toggle_submenu(){

    let mavState = this.dataset.state;
    let mavNumber = this.dataset.number;

    switch (mavState) {
        case 'close':
            mavState = 'open';
            console.log(this);
        break;
        case 'open':
            mavState = 'close';
            console.log(this);
        break;
    }

    this.dataset.state = mavState;

    const mavSubMenu = document.querySelector(`.sub-menu[data-number="${mavNumber}"]`);
    mavSubMenu.dataset.state  = mavState;
}

/*
 * Mobile Menu Checker
 */
function mavf_mobile_menu_checker() {

    mavf_reset_submenu_icon();

    const mavWindowWidth = window.innerWidth;
    const mavWindowHeight = window.innerHeight;

    const mavPageMain = document.querySelector('#mavid-page-main-content');

    const mavHeaderMenuWrapper = document.querySelector('.mav-header-menu-wrapper');

    const mavHeaderHeight = document.querySelector('.mav-header-logo-ctn').offsetHeight;

    if (mavWindowWidth > 1023) {

        /* Show header menu */
        mavHeaderMenuWrapper.classList.remove('mav-hide-on-mobile');

        /* Reset page main content top padding */
        mavPageMain.style.paddingTop = null;
        document.querySelector('#mavid-sec-header-menu').style.paddingTop = 0;


    } else {

        /* Hide menu on mobile devices */
        mavHeaderMenuWrapper.classList.add('mav-hide-on-mobile');

        /* Set mobile menu max height */
        let mavMenuMaxHeight = mavWindowHeight - mavHeaderHeight;
        document.querySelector('.mav-header-menu').setAttribute('style' , `max-height: ${mavMenuMaxHeight}px`);

        /* Replace mobile menu icon */
        mavMobileMenuIcon.classList.remove('fa-times');
        mavMobileMenuIcon.classList.add('fa-bars');

    }
}
mavf_mobile_menu_checker();

/*
 * Toggle mobile menu
 */
function mavf_replace_mobile_menu_icon() {
    // const mavMobileMenuIcon = document.querySelector('.mav-mobile-menu-icon')
    mavMobileMenuIcon.classList.toggle('fa-bars');
    mavMobileMenuIcon.classList.toggle('fa-times');
}

function mavf_toggle_mobile_menu(){
    document.querySelector('.mav-header-menu-wrapper').classList.toggle('mav-hide-on-mobile');
    mavf_replace_mobile_menu_icon();
    mavf_reset_submenu_icon();
}

function mavf_reset_submenu_icon(){
    mavSubMenuParentItems.forEach((e)=>{
        e.querySelector('.sub-menu').dataset.state = 'close';
    });
    mavSubMenuIcons.forEach((e)=>{
        e.dataset.state = 'close';
    });
}

mavMobileMenuIcon.addEventListener('click', mavf_toggle_mobile_menu);

/*
 * Reset header menu on window resize
 */
window.addEventListener('resize', mavf_window_resize_events);

function mavf_window_resize_events(){
    mavf_mobile_menu_checker();
}